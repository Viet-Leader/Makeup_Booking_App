<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./assets/style.css"/>
    <link rel="stylesheet" href="./assets/reset.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"/>
    <title>Check-In Khách Hàng</title>
</head>
<body>
<div class="col_1_2">
    <!-- Sidebar -->
    <div class="box_1">
            <div class="box_1_1">
                <div class="banner">
                    <h2>Receptionist panel</h2>
                    <p>Receptionist user</p>
                </div>
            </div>
            <div class="box_1_2">
                <div class="nav_menu">
                    <ul>
                        <li><div class="box_1_2_1"><a href="home.html"><i class="fa-solid fa-table-columns"></i> Tổng Quan</a></div></li>
                        <li><div class="box_1_2_1"><a href="customer.html"><i class="fa-regular fa-user"></i> Khách Hàng</a></div></li>
                        <li><div class="box_1_2_1 active"><a href="checkin.html"><i class="fa-solid fa-store"></i> Check-In</a></div></li>
                        <li><div class="box_1_2_1"><a href="./appointment.html"><i class="fa-solid fa-calendar"></i> Đặt Lịch</a></div></li>
                    </ul>
                </div>
            </div>
            <div class="box_1_3">
                <button class="btn-logout">
                    <a href="#!">Đăng xuất</a>
                </button>
            </div>
    </div>

    <!-- Nội dung Check-In -->
    <div class="box_2">
        <div class="box_2_1">
            <div class="header_row">
                <h1>Danh sách Check-In</h1>
            </div>
        </div>
        <div class="box_2_2">
            <div class="content">
                <table class="customer-table">
                    <thead>
                    <tr>
                        <th>Khách hàng</th>
                        <th>Số điện thoại</th>
                        <th>Ngày & Giờ</th>
                        <th>Trạng thái</th>
                        <th>Hành động</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="appointment : ${appointments}">
                        <td th:text="${appointment.customer.nameAccount}"></td>
                        <td th:text="${appointment.customer.phone}"></td>
                        <td th:text="${appointment.appointmentDate}"></td>
                        <td>
                            <span th:id="'status-' + ${appointment.appointmentId}" th:text="${appointment.status}">STATUS</span>
                        </td>
                        <td>
                            <button th:id="'btn-' + ${appointment.appointmentId}"
                                    th:disabled="${appointment.status == 'CHECKED_IN'}"
                                    th:onclick="|checkInAppointment(${appointment.appointmentId})|"
                                    class="btn-checkin">
                                <span th:text="${appointment.status == 'Đã Check-In' ? 'Đã Check-In' : 'Check-In'}"></span>
                            </button>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- ✅ JavaScript -->
<script>
    function checkInAppointment(appointmentId) {
        fetch('/receptionist/update-status', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: `appointmentId=${appointmentId}&status=Confirm`
        })
            .then(response => response.text())
            .then(message => {
                alert(message);
                document.getElementById(`status-${appointmentId}`).innerText = 'Confirm';
                const button = document.getElementById(`btn-${appointmentId}`);
                button.disabled = true;
                button.innerHTML = 'Confirm';
            })
            .catch(err => {
                console.error('Lỗi:', err);
                alert("Có lỗi xảy ra khi gửi yêu cầu!");
            });
    }
</script>
</body>
</html>
